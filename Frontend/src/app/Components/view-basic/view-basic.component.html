<div class="container-fluid">
  <!-- Add Graph Picker at the top -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="graph-picker-row">
        <app-graph-picker></app-graph-picker>
      </div>

      <!-- Warning when no graph is selected -->
      <div *ngIf="!hasSelectedGraph" class="alert alert-warning mt-3">
        Please select or create a graph to start modeling.
        <div class="mt-2">
          <button class="btn btn-primary btn-sm" routerLink="/graph-manager">Go To Graph Manager</button>
        </div>
      </div>
    </div>
  </div>

  <!-- View Nodes Component -->
  <div class="card mb-4" *ngIf="hasSelectedGraph">
    <div class="card-header">
      <h5>Nodes</h5>
      <button class="btn btn-sm btn-outline-secondary collapse-toggle" (click)="toggleViewNodesPanel()">
        <i class="bi" [ngClass]="viewNodesPanelCollapsed ? 'bi-chevron-down' : 'bi-chevron-up'"></i>
      </button>
    </div>
    <div class="card-body" [class.d-none]="viewNodesPanelCollapsed">
      <app-view-nodes #viewNodes (nodeSelected)="onNodeSelected($event)"></app-view-nodes>
    </div>
  </div>

  <!-- View Edges Component -->
  <div class="card mb-4" *ngIf="hasSelectedGraph">
    <div class="card-header">
      <h5>Connections</h5>
      <button class="btn btn-sm btn-outline-secondary collapse-toggle" (click)="toggleViewEdgesPanel()">
        <i class="bi" [ngClass]="viewEdgesPanelCollapsed ? 'bi-chevron-down' : 'bi-chevron-up'"></i>
      </button>
    </div>
    <div class="card-body" [class.d-none]="viewEdgesPanelCollapsed">
      <app-view-edges #viewEdges (edgeSelected)="onEdgeSelected($event)"></app-view-edges>
    </div>
  </div>

  <!-- Tools panel (collapsible sidebar) that includes creation tools -->
  <div class="tools-panel-container" [class.collapsed]="toolsPanelCollapsed" *ngIf="hasSelectedGraph">
    <button class="tools-panel-toggle" (click)="toggleToolsPanel()">
      <i class="bi" [ngClass]="toolsPanelCollapsed ? 'bi-chevron-left' : 'bi-chevron-right'"></i>
    </button>

    <div class="tools-panel">
      <!-- Tab navigation like in view-fancy -->
      <ul ngbNav #nav="ngbNav" [(activeId)]="activeTab" (activeIdChange)="onTabChange($event)" class="nav-tabs">
        <li [ngbNavItem]="1">
          <a ngbNavLink>Nodes</a>
          <ng-template ngbNavContent>
            <app-create-node></app-create-node>
          </ng-template>
        </li>
        <li [ngbNavItem]="2">
          <a ngbNavLink>Connections</a>
          <ng-template ngbNavContent>
            <app-create-edge></app-create-edge>
          </ng-template>
        </li>
      </ul>

      <div [ngbNavOutlet]="nav" class="tab-content"></div>
    </div>
  </div>
  <!-- Add this right before the details-panel component -->
  <div class="details-panel-backdrop"
       [class.active]="selectedElement"
       (click)="onBackdropClick()"></div>

  <app-details-panel [selectedElement]="selectedElement"
                     [isDarkMode$]="isDarkMode$"
                     [graphId]="currentGraphId"
                     (closePanel)="closeDetailsPanel()">
  </app-details-panel>

</div>
